<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Enhanced Contract Form View -->
    <record id="view_contract_form_inherit" model="ir.ui.view">
        <field name="name">contract.contract.form.inherit</field>
        <field name="model">contract.contract</field>
        <field name="inherit_id" ref="contract.contract_contract_form_view"/>
        <field name="arch" type="xml">
            
            <!-- Add buttons in header -->
            <header position="inside">
                <button name="action_submit_for_approval" 
                        string="Submit for Approval" 
                        type="object" 
                        class="btn-primary"
                        invisible="approval_state != 'draft'"/>
                <button name="action_approve_contract" 
                        string="Approve" 
                        type="object" 
                        class="btn-success"
                        invisible="approval_state != 'pending'"/>
                <button name="action_reject_contract" 
                        string="Reject" 
                        type="object" 
                        class="btn-danger"
                        invisible="approval_state != 'pending'"/>
                <button name="action_reset_to_draft" 
                        string="Reset to Draft" 
                        type="object"
                        invisible="approval_state == 'draft'"/>
                <field name="approval_state" widget="statusbar" statusbar_visible="draft,pending,approved"/>
            </header>
            
            <!-- Add stat buttons -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_sale_orders" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-shopping-cart">
                    <field name="sale_order_count" widget="statinfo" string="Sale Orders"/>
                </button>
            </xpath>
            
            <!-- Add approval and financial fields -->
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="approval_team_id" 
                       options="{'no_create': True}"
                       required="1"/>
                <field name="contract_amount" widget="monetary"/>
            </xpath>
            
            <!-- Add financial summary group -->
            <xpath expr="//page[@name='other_info']" position="before">
                <page string="Financial Summary" name="financial_summary">
                    <group>
                        <group string="Contract Amounts">
                            <field name="contract_amount" widget="monetary" readonly="1"/>
                            <field name="used_amount" widget="monetary"/>
                            <field name="remaining_amount" widget="monetary"/>
                        </group>
                        <group string="Approval Information">
                            <field name="approved_by_id"/>
                            <field name="approved_date"/>
                            <field name="rejection_reason" 
                                   invisible="approval_state != 'rejected'"/>
                        </group>
                    </group>
                    
                    <group string="Linked Sale Orders">
                        <field name="sale_order_ids" nolabel="1">
                            <tree>
                                <field name="name"/>
                                <field name="partner_id"/>
                                <field name="date_order"/>
                                <field name="amount_total" sum="Total"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </group>
                </page>
            </xpath>
            
        </field>
    </record>
    
    <!-- Enhanced Contract Tree View -->
    <record id="view_contract_tree_inherit" model="ir.ui.view">
        <field name="name">contract.contract.tree.inherit</field>
        <field name="model">contract.contract</field>
        <field name="inherit_id" ref="contract.contract_contract_tree_view"/>
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="approval_state" 
                       decoration-success="approval_state == 'approved'"
                       decoration-warning="approval_state == 'pending'"
                       decoration-danger="approval_state == 'rejected'"
                       widget="badge"/>
                <field name="contract_amount" sum="Total Amount"/>
                <field name="used_amount" sum="Total Used"/>
                <field name="remaining_amount" sum="Total Remaining"/>
            </field>
        </field>
    </record>
    
    <!-- Contract Search View -->
    <record id="view_contract_search_inherit" model="ir.ui.view">
        <field name="name">contract.contract.search.inherit</field>
        <field name="model">contract.contract</field>
        <field name="inherit_id" ref="contract.contract_contract_search_view"/>
        <field name="arch" type="xml">
            <search position="inside">
                <field name="approval_team_id"/>
                <field name="approval_state"/>
                <filter name="filter_draft" string="Draft" domain="[('approval_state', '=', 'draft')]"/>
                <filter name="filter_pending" string="Pending Approval" domain="[('approval_state', '=', 'pending')]"/>
                <filter name="filter_approved" string="Approved" domain="[('approval_state', '=', 'approved')]"/>
                <filter name="filter_rejected" string="Rejected" domain="[('approval_state', '=', 'rejected')]"/>
                <group expand="0" string="Group By">
                    <filter name="group_approval_state" string="Approval State" context="{'group_by': 'approval_state'}"/>
                    <filter name="group_approval_team" string="Approval Team" context="{'group_by': 'approval_team_id'}"/>
                </group>
            </search>
        </field>
    </record>

</odoo>
